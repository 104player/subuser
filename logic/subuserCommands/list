#!/usr/bin/env python
# This file should be compatible with both Python 2 and 3.
# If it is not, please file a bug report.
import sys,os,optparse

import subuserlib.registry,subuserlib.paths,subuserlib.permissions,subuserlib.availablePrograms,subuserlib.commandLineArguments

def parseCliArgs():
  usage = "usage: subuser %prog WHAT_TO_LIST [options]"
  description = """   List subuser-programs.  You can use this command to list programs that are:

  available 
      List all subuser-programs
  installed 
      List all subuser-programs which are already installed/registered

  EXAMPLES:
    $ subuser list available --short
    $ subuser list installed
"""
  parser=optparse.OptionParser(usage=usage,description=description,formatter=subuserlib.commandLineArguments.HelpFormatterThatDoesntReformatDescription())
  parser.add_option("--short",dest="short",action="store_true",default=False,help="Only display the names of the programs to be listed, and no other information.")
  return parser.parse_args()

def printProgramList(programs):
  for program in programs:
    permissions = subuserlib.permissions.getPermissions(program)
    print(program)
    print("----------------")
    print("Description: "+permissions["description"])
    print("Maintainer: "+permissions["maintainer"])
    print("\n")

#################################################################################################

options,args = parseCliArgs()

if len(args)==0:
  sys.exit("Nothing to list. Issue this command with the -h argument for help.")

if 'available' in args:
  if options.short:
    print(subuserlib.availablePrograms.getAvailableProgramsText(addNewLine=False, indentSpaces=3))
    sys.exit()
  else:
    print("#########################################")
    print("Available programs:")
    print("#########################################")
    availablePrograms = subuserlib.availablePrograms.getAvailablePrograms()
    printProgramList(availablePrograms)

if 'installed' in args:
  if options.short:
    print(subuserlib.registry.getInstalledProgramsText(addNewLine=False, indentSpaces=3))
    sys.exit()
  else:
    print("#########################################")
    print("Installed programs:")
    print("#########################################")
    installedPrograms = subuserlib.registry.getInstalledPrograms()
    printProgramList(installedPrograms)
